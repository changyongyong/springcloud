!function (a, b) {
    a.sobox = {maskIndex: 0, showMask: function (c) {
        var e, f, g, d = this;
        return c ? (e = a(".so-openmask"), e.length ? d.maskIndex++ : (e = a('<div class="so-openmask"></div>'), a("body").append(e), d.maskIndex = 1), f = "undefined" == typeof b.body.style.maxHeight ? b : window, g = a(f).height() - 18, e.height(c ? g + 20 : 0), a(window).resize(function () {
            var b = a(f).height() - 18;
            e.height(c ? b + 20 : 0)
        }), e.css("z-index", 1e3 + 10 * d.maskIndex)) : e = null, e
    }, show: function (b, c, d) {
        var e = this, f = a(b.obj), g = e.showMask(c);
        return e.setPos(b), b.onlyOne && a("body").data("soonlyone", !0), f.css("z-index", 1002 + 10 * e.maskIndex).fadeIn(), f.find(".s-close").bind("click", function () {
            e.hide(f)
        }), d && d(), g
    }, hide: function (b, c, d) {
        var e = this, f = a(".so-openmask");
        a(b).fadeOut("fast", function () {
            a("select").show(), d && d()
        }), c && (e.maskIndex--, f.css("z-index", 1e3 + 10 * e.maskIndex), 0 == e.maskIndex && f.remove()), a(b).find(".s-close").unbind("click")
    }, drag: function (c, d) {
        function g(a) {
            null == a && (a = window.event), e.css({opacity: "0.4", left: a.clientX - posX + "px", top: a.clientY - posY + "px"})
        }

        var e = a(c), f = a(d);
        f.mousedown(function (c) {
            c || (c = window.event), posX = c.clientX - parseInt(e.css("left")), posY = c.clientY - parseInt(e.css("top")), a(b).bind("mousemove.drag", function (a) {
                g(a)
            })
        }), a(b).mouseup(function (c) {
            c.target == f.get(0) && (a(b).unbind("mousemove.drag"), e.css({opacity: "1"}))
        })
    }, setPos: function (c) {
        var e, f, g, h, i, j, k, l, m, n;
        switch (c = a.extend({mode: "center", obj: null, pos: [0, 0], offset: [0, 0]}, c), e = a(c.obj), f = Math.floor(e.height() / 2), g = Math.floor(e.width() / 2), h = a(window).scrollTop(), i = a(window).height(), j = c.pos[0], k = c.pos[1], l = c.offset[0], m = c.offset[1], e.css({position: "fixed"}), "undefined" == typeof b.body.style.maxHeight && (n = e.find("select"), a("select").not(n).hide()), c.mode) {
            case"win":
                e.css({left: j + l, top: k + m}), "undefined" == typeof b.body.style.maxHeight && e.css({position: "absolute", top: h + k + m});
                break;
            case"doc":
                e.css({position: "absolute", left: j + l, top: k + m});
                break;
            case"tc":
                e.css({left: "50%", top: m, marginLeft: -g + l}), "undefined" == typeof b.body.style.maxHeight && e.css({position: "absolute", top: h + m});
                break;
            case"bc":
                e.css({left: "50%", bottom: m, marginLeft: -g + l}), "undefined" == typeof b.body.style.maxHeight && e.css({position: "absolute", top: h + m + i});
                break;
            default:
                e.css({top: "50%", left: "50%", marginTop: -f - 10 + m, marginLeft: -g + l}), "undefined" == typeof b.body.style.maxHeight && e.css({position: "absolute", top: h + i / 2})
        }
    }, pop: function (b) {
        function j(i) {
            var j, l, m;
            b = a.extend(b, i || {}), b.showTitle && e.append(f), b.outCloseBtn && g.addClass("s-sopop-out-close"), e.append(g).append(h), b.height && "iframe" != b.type && e.css("height", b.height + "px"), e.css({visibility: b.visibility ? "visible" : "hidden"}), "content" == b.type && h.html(b.content), "target" == b.type && (j = a(b.target).show(), h.append(j)), "iframe" == b.type && (l = a('<iframe id="' + b.iframeID + '" name="' + b.iframeID + '" src="' + b.iframe + '" width="100%" height="' + b.height + '" frameborder="0" scrolling="auto"></iframe>'), h.html(l)), "ajax" == b.type && h.load(b.ajax.url, b.ajax.data, function () {
                c.setPos({mode: b.posType, obj: e, pos: b.pos, offset: b.offset}), b.ajax.callback && b.ajax.callback()
            }), b.btn.length > 0 && (m = a('<p class="p-so-popBtn"></p>'), a.each(b.btn, function () {
                var b = a.extend({cls: null, text: "确定", link: "#", removePop: !0, callback: function () {
                }}, this), c = a('<a class="a-sopop-btn" href="' + b.link + '"><span class="s-sopop-btn">' + b.text + "</span></a>");
                null !== b.cls && c.addClass(b.cls), c.bind("click", function () {
                    return b.callback && b.callback(k), b.removePop && k(), "#" === b.link ? !1 : !0
                }), m.append(c)
            }), e.append(m)), a("body").append(e), b.showTitle && b.drag && (f.addClass("h2-sopop-move"), c.drag(e, f)), b.beforePop(e, f, g, h), d = c.show({mode: b.posType, obj: e, pos: b.pos, offset: b.offset, onlyOne: b.onlyOne}, b.showMask, b.onPop(e)), g.bind("click", function () {
                k()
            }), d && b.maskClick && d.bind("click", function () {
                k()
            })
        }

        function k(d) {
            b = a.extend(b, d || {}), c.hide(e, b.showMask), a("body").removeData("soonlyone"), null != b.target && a(b.target).appendTo("body").hide(), e.remove(), b.closePop()
        }

        var d, e, f, g, h, i, c = this;
        return b = a.extend({type: "content", target: null, content: null, iframe: null, iframeID: "sopop-iframe", ajax: {url: null, data: null, callback: function () {
        }}, posType: "center", pos: [0, 0], offset: [0, 0], cls: null, width: 400, height: null, defaultShow: !0, visibility: !0, title: "提示", showTitle: !0, outCloseBtn: !1, showMask: !0, onlyOne: !1, drag: !0, maskClick: !0, btn: [], beforePop: function () {
        }, onPop: function () {
        }, closePop: function () {
        }}, b || {}), e = a('<div class="so-popbox ' + (b.cls ? b.cls : "") + '" style="width:' + b.width + 'px;display:none;"></div>'), f = a('<h2 class="h2-sopop"><span class="s-sopop-title">' + b.title + "</span></h2>"), g = a('<span class="s-sopop-close">[关闭]</span>'), h = a('<div class="so-popbox-cont"></div>'), i = a("body").data("soonlyone"), b.defaultShow && !i && j(), {wrap: e, mask: d, opt: b, removePop: k, showPop: j}
    }, alert: function (a, b, c) {
        var d = this;
        d.pop({cls: "so-popAlert", title: a, width: 360, content: b, btn: [
            {text: "确定", callback: function () {
                c && c()
            }}
        ]})
    }, confirm: function (a, b, c, d) {
        var e = this;
        e.pop({cls: "so-popConfirm", title: a, width: 360, content: b, btn: [
            {text: "确定", callback: function () {
                c && c()
            }},
            {text: "取消", cls: "a-sopop-cancel", callback: function () {
                d && d()
            }}
        ]})
    }, tip: function (b) {
        var e, c = this, d = null;
        return b = a.extend({cls: "so-popTip", showTitle: !1, posType: "tc", showMask: !1, width: 250, stayTime: 5e3, offset: [0, 5], closePop: function () {
            d && clearTimeout(d)
        }}, b || {}), e = c.pop(b), b.stayTime > 0 && (d = setTimeout(function () {
            e.removePop()
        }, b.stayTime)), e
    }, loading: function (b) {
        var d, c = this;
        return b = a.extend({type: "content", cls: "so-loading", showTitle: !1, maskClick: !1, width: 80, height: 36, content: "", stayTime: 0}, b || {}), d = c.pop(b), b.stayTime > 0 && setTimeout(function () {
            d.removePop()
        }, b.stayTime), {open: d.showPop, close: d.removePop}
    }}, a.fn.soIframePop = function (b) {
        var c = a.extend({type: "iframe", targetTag: "href", splitString: "#soIframe?", width: 800, height: 480, showTitle: !1}, b || {}), d = [];
        return this.each(function () {
            var g, h, b = a(this), e = b.attr(c.targetTag).split(c.splitString), f = e[0];
            par = e[1] ? e[1].split("&") : "", g = {}, a.each(par, function () {
                var a = this.split("=");
                g[a[0]] = a[1]
            }), c = a.extend(c, g || {}), c.showTitle = "true" == c.showTitle ? 1 : +c.showTitle, c.iframe = f, c.defaultShow = !1, h = a.sobox.pop(c), d.push(h), b.click(function () {
                return h.showPop(), a(this).data("iframePop", h), !1
            })
        }), d
    }, a.fn.soSidePop = function (b) {
        var c = a(this), d = b.event || "click", e = null;
        return c.bind(d, function (c) {
            var d = a(this).offset(), f = "mouse" == b.por ? [c.pageX, c.pageY] : [d.left, d.top], g = a.extend({showMask: !1, posType: "doc", por: "mouse", pos: f, offset: [10, 10], onlyOne: !0, returnFalse: !0}, b || {});
            return e = a.sobox.pop(g), g.returnFalse ? !1 : void 0
        }), "mouseover" == d && c.bind("mouseout", function () {
            e.removePop()
        }), c
    }, a.fn.soOverTip = function (b) {
        var c = a(this), d = a.extend({cls: "so-overTip", showMask: !1, posType: "doc", offset: [10, 10], showTitle: !1, onlyOne: !0}, b || {}), e = null;
        return c.mouseenter(function (b) {
            d.pos = [b.pageX, b.pageY], e = a.sobox.pop(d)
        }).mouseleave(function () {
            e.removePop()
        }), c
    }
}(jQuery, document);